[section#simd.permute.mask
    [:en] [`vec] mask permute
    [:zh_CN] [`vec] 的掩模排列
]

[%@lib@member compress[!simd]]
[codeblock:declaration]
template<[[redoc("*:c>")]]simd-vec-type V>
  constexpr V compress(const V& v, const typename V::mask_type& selector);
template<[[redoc("*:c>")]]simd-mask-type M>
  constexpr M compress(const M& v, const type_identity_t<M>& selector);
[codeblock:end]

[div:description]
[para]
[:en] Let
[:zh_CN] 令
[list]
[item]
[:en@~] [`[*bit-index]([$i])] be a function which returns the index
of the [$i^\text{th}] element of [`selector] that is [`true].
[:zh_CN@~] [`[*bit-index]([$i])] 为返回 [`selector] 中第 [$i] 个为 [`true] 元素的索引的函数。
[item]
[:en@~] [`[*select-value]([$i])] be a function which returns
[`v`[[*bit-index]([$i])`]] for [$i] in the range
[=range(0,reduce_count(selector))] and a valid but unspecified value otherwise.
[:zh_CN@~] [`[*select-value]([$i])] 为函数，对于范围 [=range(0,reduce_count(selector))]
中的 [$i] 返回 [`v`[[*bit-index]([$i])`]]，否则返回有效但未指明的值。

[begin:note]
[:en] Different calls to [*select-value] can return different unspecified values.
[:zh_CN] 对 [*select-value] 的不同次调用可以返回不同的未指明值。
[end:note]
[list:end]

[para:returns]
[:en] A data-parallel object where the [$i^\text{th}] element is initialized to
the result of [`[*select-value]([$i])] for all [$i] in the range [=range(0,V::size())].
[:zh_CN] 一个数据并行对象，对于范围 [=range(0,V::size())] 中的所有 [$i]，其第 [$i] 个元素
初始化为 [`[*select-value]([$i])] 的结果。
[div:end]

[%@lib@member compress[!simd]]
[codeblock:declaration]
template<[[redoc("*:c>")]]simd-vec-type V>
  constexpr V compress(const V& v, const typename V::mask_type& selector,
                       const typename V::value_type& fill_value);
template<[[redoc("*:c>")]]simd-mask-type M>
  constexpr M compress(const M& v, const type_identity_t<M>& selector,
                       const typename V::value_type& fill_value);
[codeblock:end]

[div:description]
[para]
[:en] Let
[:zh_CN] 令
[list]
[item]
[:en@~] [`[*bit-index]([$i])] be a function which returns the index
of the [$i^\text{th}] element of [`selector] that is [`true].
[:zh_CN@~] [`[*bit-index]([$i])] 为返回 [`selector] 中第 [$i] 个为 [`true] 元素的索引的函数。
[item]
[:en@~] [`[*select-value]([$i])] be a function which returns
[`v`[[*bit-index]([$i])`]] for [$i] in the range
[=range(0,reduce_count(selector))] and [`fill_value] otherwise.
[:zh_CN@~] [`[*select-value]([$i])] 为函数，对于范围 [=range(0,reduce_count(selector))]
中的 [$i] 返回 [`v`[[*bit-index]([$i])`]]，否则返回 [`fill_value]。
[list:end]

[para:returns]
[:en] A data-parallel object where the [$i^\text{th}] element is initialized to
the result of [`[*select-value]([$i])] for all [$i] in the range [=range(0,V::size())].
[:zh_CN] 一个数据并行对象，对于范围 [=range(0,V::size())] 中的所有 [$i]，其第 [$i] 个元素
初始化为 [`[*select-value]([$i])] 的结果。
[div:end]

[%@lib@member expand[!simd]]
[codeblock:declaration]
template<[[redoc("*:c>")]]simd-vec-type V>
  constexpr V expand(const V& v, const typename V::mask_type& selector, const V& original = {});
template<[[redoc("*:c>")]]simd-mask-type M>
  constexpr M expand(const M& v, const type_identity_t<M>& selector, const M& original = {});
[codeblock:end]

[div:description]
[para]
[:en] Let
[:zh_CN] 令
[list]
[item]
[:en@~] [*set-indices] be a list of the index positions of [`true] elements in [`selector].
[:zh_CN@~] [*set-indices] 为 [`selector] 中 [`true] 元素的索引位置的列表。
[item]
[:en@~] [`[*bit-lookup]([$b])] be a function which returns the index where [$b]
appears in [*set-indices].
[:zh_CN@~] [`[*bit-lookup]([$b])] 为返回 [*set-indices] 中出现 [$b] 的索引的函数。
[item]
[:en@~] [`[*select-value]([$i])] be a function which returns [`v`[[*bit-lookup]([$i])`]]
if [`selector`[[$i]`]] is [`true], otherwise returns [`original`[[$i]`]].
[:zh_CN@~] [`[*select-value]([$i])] 为函数，当 [`selector`[[$i]`]] 为 [`true] 时
返回 [`v`[[*bit-lookup]([$i])`]]，否则返回 [`original`[[$i]`]]。
[list:end]

[para:returns]
[:en] A data-parallel object where the [$i^\text{th}] element is initialized to
the result of [`[*select-value]([$i])] for all [$i] in the range [=range(0,V::size())].
[:zh_CN] 一个数据并行对象，对于范围 [=range(0,V::size())] 中的所有 [$i]，其第 [$i] 个元素
初始化为 [`[*select-value]([$i])] 的结果。
[div:end]
