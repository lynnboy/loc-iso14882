[section#format.string.escaped
    [:en] Formatting escaped characters and strings
    [:zh_CN] ç»è½¬ä¹‰å­—ç¬¦å’Œå­—ç¬¦ä¸²çš„æ ¼å¼åŒ–
]

[para]
[:en]
[%string[!formatted as escaped]]
[%character[!formatted as escaped]]
A character or string can be formatted as [+escaped] to make it more suitable
for debugging or for logging.
[:zh_CN]
[%å­—ç¬¦ä¸²[!æ ¼å¼åŒ–ä¸ºç»è½¬ä¹‰ï½]]
[%å­—ç¬¦[!æ ¼å¼åŒ–ä¸ºç»è½¬ä¹‰ï½]]
å¯ä»¥å°†å­—ç¬¦æˆ–å­—ç¬¦ä¸²æ ¼å¼åŒ–ä¸º[+ç»è½¬ä¹‰]çš„ï¼Œä»¥ä½¿å…¶æ›´é€‚ç”¨äºè°ƒè¯•æˆ–æ—¥å¿—ã€‚

[para]
[:en] The escaped string [^E] representation of a string [^S] is constructed by
encoding a sequence of characters as follows.
[:zh_CN] å­—ç¬¦ä¸² [^S] çš„ç»è½¬ä¹‰å­—ç¬¦ä¸²è¡¨ç¤º [^E] æ˜¯ä»¥å¦‚ä¸‹æ–¹å¼å¯¹å­—ç¬¦çš„åºåˆ—è¿›è¡Œç¼–ç è€Œ
æ„é€ çš„ã€‚

[:en] The associated character encoding [^CE] for [`charT]
([#:tab#lex.string.literal]) is used to both interpret [^S] and construct [^E].
[:zh_CN] [^S] çš„è§£é‡Šå’Œ [^E] çš„æ„é€ å‡é€‚ç”¨é’ˆå¯¹ [`charT] çš„å…³è”å­—ç¬¦ç¼–ç 
ï¼ˆ[#:tab#lex.string.literal]ï¼‰ã€‚

[list]
[item]
[:en] [=unicode(0022,quotation mark)] ([`"]) is appended to [^E].
[:zh_CN] å‘ [^E] è¿½åŠ  [=unicode(0022,quotation mark)]ï¼ˆ[`"]ï¼‰ã€‚

[item]
[:en] For each code unit sequence [^X] in [^S] that either encodes a single
character, is a shift sequence, or is a sequence of ill-formed code units,
processing is in order as follows:
[:zh_CN] å¯¹äº [^S] ä¸­æ¯ä¸ªä»£ç å•å…ƒåºåˆ— [^X]ï¼Œå…¶æˆ–è€…ç¼–ç å•ä¸ªå­—ç¬¦ï¼Œæˆ–è€…æ˜¯æ¢æ¡£åºåˆ—ï¼Œ
æˆ–è€…æ˜¯éè‰¯æ„ä»£ç å•å…ƒçš„åºåˆ—ï¼Œä»¥å¦‚ä¸‹æ¬¡åºè¿›è¡Œå¤„ç†ï¼š

[list]
[item]
[:en] If [^X] encodes a single character [^C], then:
[:zh_CN] å¦‚æœ [^X] ç¼–ç å•ä¸ªå­—ç¬¦ [^C]ï¼Œåˆ™ï¼š

[list]
[item]
[:en] If [^C] is one of the characters in [#:tab#format.escape.sequences], then
the two characters shown as the corresponding escape sequence are appended to [^E].
[:zh_CN] å¦‚æœ [^C] æ˜¯ [#:tab#format.escape.sequences] ä¸­çš„å­—ç¬¦ä¹‹ä¸€ï¼Œåˆ™å°†æ‰€ç»™å‡ºçš„
ä¸¤ä¸ªå­—ç¬¦ä½œä¸ºå…¶å¯¹åº”çš„è½¬ç§»åºåˆ—è¿½åŠ åˆ° [^E]ã€‚

[item]
[:en] Otherwise, if [^C] is not [=unicode(0020,space)] and
[:zh_CN] å¦åˆ™ï¼Œå¦‚æœ [^C] ä¸æ˜¯ [=unicode(0020,space)] å¹¶ä¸”

[list]
[item]
[:en] [^CE] is UTF-8, UTF-16, or UTF-32 and [^C] corresponds to a Unicode scalar
value whose Unicode property [`General_Category] has a value in the groups
[`Separator] ([`Z]) or [`Other] ([`C]), as described by UAX #44 of the Unicode
Standard, or
[:zh_CN] [^CE] æ˜¯ UTF-8ï¼ŒUTF-16 æˆ– UTF-32ï¼Œä¸” [^C] æ‰€å¯¹åº”çš„ Unicode æ ‡é‡å€¼çš„
Unicode å±æ€§ [`General_Category] çš„å€¼å±äº [`Separator]ï¼ˆ[`Z]ï¼‰ç»„æˆ– [`Other]
ï¼ˆ[`C]ï¼‰ç»„ï¼Œå¦‚ Unicode æ ‡å‡† UAX #44 æ‰€è¿°ï¼Œæˆ–è€…

[item]
[:en] [^CE] is UTF-8, UTF-16, or UTF-32 and [^C] corresponds to a Unicode scalar
value with the Unicode property [`Grapheme_Extend=Yes] as described by UAX #44
of the Unicode Standard and [^C] is not immediately preceded in [^S] by a
character [^P] appended to [^E] without translation to an escape sequence, or
[:zh_CN] [^CE] æ˜¯ UTF-8ï¼ŒUTF-16 æˆ– UTF-32ï¼Œä¸” [^C] æ‰€å¯¹åº”çš„ Unicode æ ‡é‡å€¼å…·æœ‰å¦‚
Unicode æ ‡å‡† UAX #44 æ‰€è¿°çš„ Unicode å±æ€§ [`Grapheme_Extend=Yes]ï¼Œå¹¶ä¸” [^C] åœ¨
[^S] ä¸­ç´§æ¥å…¶ä¹‹å‰çš„å¹¶éæ˜¯æœªç»ç¿»è¯‘ä¸ºè½¬ç§»åºåˆ—è€Œè¿½åŠ åˆ° [^E] ä¹‹åçš„å­—ç¬¦ï¼Œæˆ–è€…

[item]
[:en] [^CE] is neither UTF-8, UTF-16, nor UTF-32 and [^C] is one of an
implementation-defined set of separator or non-printable characters
[:zh_CN] [^CE] ä¸æ˜¯ UTF-8ï¼ŒUTF-16 æˆ– UTF-32 ç¼–ç ï¼Œä¸” [^C] ä¸ºç”±å®ç°å®šä¹‰çš„åˆ†éš”ç¬¦æˆ–
ä¸å¯æ‰“å°å­—ç¬¦é›†åˆä¹‹ä¸€
[list:end]

[:en] then the sequence [`\u{[^hex-digit-sequence]}] is appended to [^E], where
[`[^hex-digit-sequence]] is the shortest hexadecimal representation of [^C]
using lower-case hexadecimal digits.
[:zh_CN] åˆ™å°†åºåˆ— [`\u{[^hex-digit-sequence]}] è¿½åŠ åˆ° [^E]ï¼Œå…¶ä¸­
[`[^hex-digit-sequence]] ä¸º [^C] ä½¿ç”¨å°å†™åå…­è¿›åˆ¶æ•°å­—çš„æœ€çŸ­åå…­è¿›åˆ¶è¡¨ç¤ºã€‚

[item]
[:en] Otherwise, [^C] is appended to [^E].
[:zh_CN] å¦åˆ™ï¼Œå°† [^C] è¿½åŠ åˆ° [^E]ã€‚
[list:end]

[item]
[:en] Otherwise, if [^X] is a shift sequence, the effect on [^E] and further
decoding of [^S] is unspecified.
[:zh_CN] å¦åˆ™ï¼Œå¦‚æœ [^X] æ˜¯æ¢æ¡£åºåˆ—ï¼Œåˆ™æœªæŒ‡æ˜å…¶å¯¹ [^E] çš„æ•ˆæœå’Œ [^S] çš„åç»­ç¼–ç ã€‚

[para:recommended:~]
[:en] A shift sequence should be represented in [^E] such that the original code
unit sequence of [^S] can be reconstructed.
[:zh_CN] æ¢æ¡£åºåˆ—åœ¨ [^E] ä¸­çš„è¡¨ç¤ºï¼Œæœ€å¥½ä½¿å…¶å¯ä»¥é‡æ„ [^S] çš„åŸå§‹ä»£ç å•å…ƒåºåˆ—ã€‚

[item]
[:en] Otherwise ([^X] is a sequence of ill-formed code units), each code unit
[^U] is appended to [^E] in order as the sequence [`\x{[^hex-digit-sequence]}],
where [`[^hex-digit-sequence]] is the shortest hexadecimal representation of [^U]
using lower-case hexadecimal digits.
[:zh_CN] å¦åˆ™ï¼ˆ[^X] ä¸ºéè‰¯æ„ä»£ç å•å…ƒçš„åºåˆ—ï¼‰ï¼Œåˆ™å°†æ¯ä¸ªä»£ç å•å…ƒ [^U] ä»¥åºåˆ—
[`\x{[^hex-digit-sequence]}] çš„å½¢å¼è¿½åŠ åˆ° [^E]ï¼Œå…¶ä¸­ [`[^hex-digit-sequence]] ä¸º
[^U] ä½¿ç”¨å°å†™åå…­è¿›åˆ¶æ•°å­—çš„æœ€çŸ­åå…­è¿›åˆ¶è¡¨ç¤ºã€‚
[list:end]

[item]
[:en] Finally, [=unicode(0022,quotation mark)] ([`"]) is appended to [`E].
[:zh_CN] æœ€åï¼Œå‘ [^E] è¿½åŠ  [=unicode(0022,quotation mark)]ï¼ˆ[`"]ï¼‰ã€‚
[list:end]

[table:grid#format.escape.sequences
    [:en] Mapping of characters to escape sequences
    [:zh_CN] å­—ç¬¦åˆ°è½¬ä¹‰åºåˆ—çš„æ˜ å°„
    [|  [:en] Character
        [:zh_CN] å­—ç¬¦ ]
    [|  [:en] Escape sequence
        [:zh_CN] è½¬ä¹‰åºåˆ— ]
]
[|] [=unicode(0009,character tabulation)]
[|] [`\t]
[-]
[|] [=unicode(000a,line feed)]
[|] [`\n]
[-]
[|] [=unicode(000d,carriage return)]
[|] [`\r]
[-]
[|] [=unicode(0022,quotation mark)]
[|] [`\"]
[-]
[|] [=unicode(005c,reverse solidus)]
[|] [`\\]
[-]
[table:end]

[para]
[:en] The escaped string representation of a character [^C] is equivalent to the
escaped string representation of a string of [^C], except that:
[:zh_CN] å­—ç¬¦ [^C] çš„ç»è½¬ä¹‰å­—ç¬¦ä¸²è¡¨ç¤ºä¸ [^C] çš„å­—ç¬¦ä¸²çš„ç»è½¬ä¹‰å­—ç¬¦ä¸²è¡¨ç¤ºç›¸åŒï¼Œä½†ï¼š

[list]
[item]
[:en] the result starts and ends with [=unicode(0027,apostrophe)] ([`'])
instead of [=unicode(0022,quotation mark)] ([`"]), and
[:zh_CN] ç»“æœçš„å¼€å§‹å’Œç»“å°¾æ˜¯ [=unicode(0027,apostrophe)]ï¼ˆ[`']ï¼‰è€Œä¸æ˜¯
[=unicode(0022,quotation mark)]ï¼ˆ[`"]ï¼‰ï¼Œå¹¶ä¸”
[item]
[:en] if [^C] is [=unicode(0027,apostrophe)], the two characters [`\'] are
appended to [^E], and
[:zh_CN] è‹¥ [^C] æ˜¯ [=unicode(0027,apostrophe)]ï¼Œåˆ™å‘ [^E] è¿½åŠ ä¸¤ä¸ªå­—ç¬¦ [`\']ï¼Œ
å¹¶ä¸”
[item]
[:en] if [^C] is [=unicode(0022,quotation mark)], then [^C] is appended unchanged.
[:zh_CN] è‹¥ [^C] æ˜¯ [=unicode(0022,quotation mark)]ï¼Œåˆ™ä¸æ”¹åŠ¨åœ°è¿½åŠ  [^C]ã€‚
[list:end]

[begin:example]
[codeblock]
string s0 = format("[{}]", "h\tllo");                   // [:en] [`s0] has value: [``[h    llo`]] \
                                                        [:zh_CN] [`s0] çš„å€¼ä¸ºï¼š[``[h    llo`]]
string s1 = format("[{:?}]", "h\tllo");                 // [:en] [`s1] has value: [``["h\tllo"`]] \
                                                        [:zh_CN] [`s1] çš„å€¼ä¸ºï¼š[``["h\tllo"`]]
string s2 = format("[{:?}]", "Ğ¡Ğ¿Ğ°ÑĞ¸Ğ±Ğ¾, Ğ’Ğ¸ĞºÑ‚Ğ¾Ñ€ â™¥ï¸!");  // [:en] [`s2] has value: [``["Ğ¡Ğ¿Ğ°ÑĞ¸Ğ±Ğ¾, Ğ’Ğ¸ĞºÑ‚Ğ¾Ñ€ â™¥ï¸!"`]] \
                                                    [:zh_CN] [`s2] çš„å€¼ä¸ºï¼š[``["Ğ¡Ğ¿Ğ°ÑĞ¸Ğ±Ğ¾, Ğ’Ğ¸ĞºÑ‚Ğ¾Ñ€ â™¥ï¸!"`]]
string s3 = format("[{:?}, {:?}]", '\'', '"');          // [:en] [`s3] has value: [``['\'', '"'`]] \
                                                        [:zh_CN] [`s3] çš„å€¼ä¸ºï¼š[``['\'', '"'`]]

// [:en] The following examples assume use of the UTF-8 encoding \
[:zh_CN] ä»¥ä¸‹ä¾‹å­å‡è®¾ä½¿ç”¨ UTF-8 ç¼–ç 
string s4 = format("[{:?}]", string("\0 \n \t \x02 \x1b", 9));
                                                    // [:en] [`s4] has value: [``["\u{0} \n \t \u{2} \u{1b}"`]] \
                                                    [:zh_CN] [`s4] çš„å€¼ä¸ºï¼š[``["\u{0} \n \t \u{2} \u{1b}"`]]
string s5 = format("[{:?}]", "\xc3\x28");           // [:en] invalid UTF-8, [`s5] has value: [``["\x{c3}("`]] \
                                                    [:zh_CN] æ— æ•ˆ UTF-8ï¼Œ[`s5] çš„å€¼ä¸ºï¼š[``["\x{c3}("`]]
string s6 = format("[{:?}]", "ğŸ¤·ğŸ»â€â™‚ï¸");                 // [:en] [`s6] has value: [``["ğŸ¤·\u{200d}â™‚"`]] \
                                                    [:zh_CN] [`s6] çš„å€¼ä¸ºï¼š[``["\x{c3}("`]]
string s7 = format("[{:?}]", "\u0301");             // [:en] [`s7] has value: [``["\u{301}"`]] \
                                                    [:zh_CN] [`s7] çš„å€¼ä¸ºï¼š[``["\u{301}"`]]
string s8 = format("[{:?}]", "\\\u0301");           // [:en] [`s8] has value: [``["\\\u{301}"`]] \
                                                    [:zh_CN] [`s8] çš„å€¼ä¸ºï¼š[``["\\\u{301}"`]]
string s9 = format("[{:?}]", "e\u0301\u0323");      // [:en] [`s9] has value: [``["eÌÌ£"`]] \
                                                    [:zh_CN] [`s9] çš„å€¼ä¸ºï¼š[``["eÌÌ£"`]]
[codeblock:end]
[end:example]
